{"version":3,"file":"_server.ts-B3PXz6dM.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/auth/signin/_server.ts.js"],"sourcesContent":["import { e as error, j as json } from \"../../../../../chunks/index2.js\";\nimport { object, string, ZodError } from \"zod\";\nimport { compare } from \"bcrypt\";\nimport { p as prisma } from \"../../../../../chunks/index4.js\";\nimport { c as createToken } from \"../../../../../chunks/index5.js\";\nconst signInSchema = object({\n  nationalId: string().length(13),\n  password: string().length(8)\n});\nconst POST = async ({ request, cookies }) => {\n  try {\n    const body = await signInSchema.parseAsync(await request.json());\n    console.log(\"ok1\");\n    const user = await prisma.user.findUnique({\n      where: {\n        nationalId: body.nationalId\n      }\n    });\n    console.log(\"ok2\");\n    if (!user) {\n      console.log(\"ok3\");\n      return error(400, JSON.stringify({ message: \"User not found, Please register.\" }));\n    }\n    if (!await compare(body.password, user.password)) {\n      console.log(\"ok4\");\n      return error(400, JSON.stringify({ message: \"Invalid password\" }));\n    }\n    const accessToken = createToken({ id: user.id });\n    cookies.set(\"access_token\", accessToken, {\n      maxAge: 60 * 60 * 24 * 7,\n      httpOnly: true,\n      sameSite: \"none\",\n      secure: false,\n      path: \"/\"\n    });\n    return json({\n      message: \"Sign in successfully\"\n    });\n  } catch (err) {\n    if (err instanceof ZodError) {\n      return error(400, JSON.stringify(err.errors));\n    }\n    console.error(err);\n    return error(500, JSON.stringify(err));\n  }\n};\nexport {\n  POST\n};\n"],"names":["object","string"],"mappings":";;;;;;;;;AAKA,MAAM,YAAY,GAAGA,UAAM,CAAC;AAC5B,EAAE,UAAU,EAAEC,UAAM,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC;AACjC,EAAE,QAAQ,EAAEA,UAAM,EAAE,CAAC,MAAM,CAAC,CAAC;AAC7B,CAAC,CAAC;AACG,MAAC,IAAI,GAAG,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,IAAI;AACN,IAAI,MAAM,IAAI,GAAG,MAAM,YAAY,CAAC,UAAU,CAAC,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AACpE,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AACtB,IAAI,MAAM,IAAI,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;AAC9C,MAAM,KAAK,EAAE;AACb,QAAQ,UAAU,EAAE,IAAI,CAAC;AACzB;AACA,KAAK,CAAC;AACN,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AACtB,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AACxB,MAAM,OAAO,KAAK,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,kCAAkC,EAAE,CAAC,CAAC;AACxF;AACA,IAAI,IAAI,CAAC,MAAM,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE;AACtD,MAAM,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;AACxB,MAAM,OAAO,KAAK,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,kBAAkB,EAAE,CAAC,CAAC;AACxE;AACA,IAAI,MAAM,WAAW,GAAG,WAAW,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC;AACpD,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,WAAW,EAAE;AAC7C,MAAM,MAAM,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;AAC9B,MAAM,QAAQ,EAAE,IAAI;AACpB,MAAM,QAAQ,EAAE,MAAM;AACtB,MAAM,MAAM,EAAE,KAAK;AACnB,MAAM,IAAI,EAAE;AACZ,KAAK,CAAC;AACN,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,OAAO,EAAE;AACf,KAAK,CAAC;AACN,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,IAAI,GAAG,YAAY,QAAQ,EAAE;AACjC,MAAM,OAAO,KAAK,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACnD;AACA,IAAI,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;AACtB,IAAI,OAAO,KAAK,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;AAC1C;AACA;;;;"}