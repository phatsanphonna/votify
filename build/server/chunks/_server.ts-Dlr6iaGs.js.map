{"version":3,"file":"_server.ts-Dlr6iaGs.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/vote/_server.ts.js"],"sourcesContent":["import { p as prisma } from \"../../../../chunks/index4.js\";\nimport { j as json } from \"../../../../chunks/index2.js\";\nimport { object, string, ZodError } from \"zod\";\nconst voteSchema = object({\n  candidateId: string(),\n  partyId: string()\n});\nconst POST = async ({ request, locals }) => {\n  const user = locals.user;\n  try {\n    const body = await voteSchema.parseAsync(await request.json());\n    await prisma.$transaction([\n      prisma.areaCandidate.update({\n        where: {\n          id: body.candidateId\n        },\n        data: {\n          score: {\n            increment: 1\n          }\n        }\n      }),\n      prisma.party.update({\n        where: {\n          id: body.partyId\n        },\n        data: {\n          votes: {\n            increment: 1\n          }\n        }\n      }),\n      prisma.user.update({\n        where: {\n          id: user.id\n        },\n        data: {\n          isVoted: true,\n          votedAt: /* @__PURE__ */ new Date()\n        }\n      })\n    ]);\n    return json({ message: \"Vote successfully; Thank you for your vote.\" });\n  } catch (err) {\n    console.error(err);\n    if (err instanceof ZodError) {\n      return json({ message: err.errors }, { status: 400 });\n    }\n    return json({ message: \"Internal server error\" }, { status: 500 });\n  }\n};\nexport {\n  POST\n};\n"],"names":["object","string"],"mappings":";;;;;AAGA,MAAM,UAAU,GAAGA,UAAM,CAAC;AAC1B,EAAE,WAAW,EAAEC,UAAM,EAAE;AACvB,EAAE,OAAO,EAAEA,UAAM;AACjB,CAAC,CAAC;AACG,MAAC,IAAI,GAAG,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK;AAC5C,EAAE,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC1B,EAAE,IAAI;AACN,IAAI,MAAM,IAAI,GAAG,MAAM,UAAU,CAAC,UAAU,CAAC,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;AAClE,IAAI,MAAM,MAAM,CAAC,YAAY,CAAC;AAC9B,MAAM,MAAM,CAAC,aAAa,CAAC,MAAM,CAAC;AAClC,QAAQ,KAAK,EAAE;AACf,UAAU,EAAE,EAAE,IAAI,CAAC;AACnB,SAAS;AACT,QAAQ,IAAI,EAAE;AACd,UAAU,KAAK,EAAE;AACjB,YAAY,SAAS,EAAE;AACvB;AACA;AACA,OAAO,CAAC;AACR,MAAM,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;AAC1B,QAAQ,KAAK,EAAE;AACf,UAAU,EAAE,EAAE,IAAI,CAAC;AACnB,SAAS;AACT,QAAQ,IAAI,EAAE;AACd,UAAU,KAAK,EAAE;AACjB,YAAY,SAAS,EAAE;AACvB;AACA;AACA,OAAO,CAAC;AACR,MAAM,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;AACzB,QAAQ,KAAK,EAAE;AACf,UAAU,EAAE,EAAE,IAAI,CAAC;AACnB,SAAS;AACT,QAAQ,IAAI,EAAE;AACd,UAAU,OAAO,EAAE,IAAI;AACvB,UAAU,OAAO,kBAAkB,IAAI,IAAI;AAC3C;AACA,OAAO;AACP,KAAK,CAAC;AACN,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,6CAA6C,EAAE,CAAC;AAC3E,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;AACtB,IAAI,IAAI,GAAG,YAAY,QAAQ,EAAE;AACjC,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,GAAG,CAAC,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC3D;AACA,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,uBAAuB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACtE;AACA;;;;"}